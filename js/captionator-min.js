/*
	Captionator 0.6 [CaptionPlanet]
	Christopher Giffard, 2011
	Share and enjoy

	https://github.com/cgiffard/Captionator
*/

(function(){var w=10,B=16,F=4.5,G=1.5,K=[0,0,0,0.5],C=!1,f={};window.captionator=f;f.CaptionatorCueStructure=function(b,d){var a=this;this.isTimeDependent=!1;this.cueSource=b;this.options=d;this.processedCue=null;this.toString=function(c){if(!1!==d.processCueHTML){var f=function(b,d){if(null===a.processedCue){var g="",p,h;for(p in b)if(p.match(/^\d+$/)&&b.hasOwnProperty(p))if(h=b[p],h instanceof Object&&h.children&&h.children.length)"v"===h.token?g+='<q data-voice="'+h.voice.replace(/[\"]/g,"")+"\" class='voice speaker-"+
h.voice.replace(/[^a-z0-9]+/ig,"-").toLowerCase()+" webvtt-span' title=\""+h.voice.replace(/[\"]/g,"")+'">'+f(h.children,d+1)+"</q>":"c"===h.token?g+="<span class='webvtt-span webvtt-class-span "+h.classes.join(" ")+"'>"+f(h.children,d+1)+"</span>":0<h.timeIn?null===c||void 0===c||0<c&&c>=h.timeIn?g+="<span class='webvtt-span webvtt-timestamp-span' data-timestamp='"+h.token+"' data-timestamp-seconds='"+h.timeIn+"'>"+f(h.children,d+1)+"</span>":c<h.timeIn&&(g+="<span class='webvtt-span webvtt-timestamp-span webvtt-cue-future' aria-hidden='true' style='opacity: 0;' data-timestamp='"+
h.token+"' data-timestamp-seconds='"+h.timeIn+"'>"+f(h.children,d+1)+"</span>"):g+=h.rawToken+f(h.children,d+1)+"</"+h.token+">";else if(h instanceof String||"string"===typeof h||"number"===typeof h)g+=h;!a.isTimeDependent&&0===d&&(a.processedCue=g);return g}return a.processedCue};return f(this,0)}return b};this.getPlain=function(a){if(!1!==d.processCueHTML){var f=function(b,d){var g="",p,h;for(p in b)if(p.match(/^\d+$/)&&b.hasOwnProperty(p))if(h=b[p],h instanceof Object&&h.children&&h.children.length)if(0<
h.timeIn){if(null===a||void 0===a||0<a&&a>=h.timeIn)g+=f(h.children,d+1)}else g+=f(h.children,d+1);else if(h instanceof String||"string"===typeof h||"number"===typeof h)g+=h;return g};return f(this,0)}return b.replace(/<[^>]*>/ig,"")}};f.CaptionatorCueStructure.prototype=[];f.TextTrack=function(b,d,a,c,e,i){this.onload=function(){};this.onerror=function(){};this.oncuechange=function(){};this.id=b||"";this.internalMode=f.TextTrack.OFF;this.cues=new f.TextTrackCueList(this);this.activeCues=new f.ActiveTextTrackCueList(this.cues,
this);this.kind=d||"subtitles";this.label=a||"";this.language=c||"";this.src=e||"";this.readyState=f.TextTrack.NONE;this.internalDefault=i||!1;this.getMode=function(){return this.internalMode};this.setMode=function(a){if(-1!==[f.TextTrack.OFF,f.TextTrack.HIDDEN,f.TextTrack.SHOWING].indexOf(a))a!==this.internalMode&&(this.internalMode=a,this.readyState===f.TextTrack.NONE&&(0<this.src.length&&a>f.TextTrack.OFF)&&this.loadTrack(this.src,null),this.videoNode._captionator_dirtyBit=!0,f.rebuildCaptions(this.videoNode),
a===f.TextTrack.OFF&&(this.cues.length=0,this.readyState=f.TextTrack.NONE));else throw Error("Illegal mode value for track: "+a);};this.getDefault=function(){return this.internalDefault};Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode),this.__defineGetter__("default",this.getDefault)):Object.defineProperty&&(Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode}),Object.defineProperty(this,"default",{get:this.getDefault}));
this.loadTrack=function(a,b){var d,c=new XMLHttpRequest;if(this.readyState===f.TextTrack.LOADED)b instanceof Function&&b(d);else{this.src=a;this.readyState=f.TextTrack.LOADING;var e=this;c.open("GET",a,true);c.onreadystatechange=function(){if(c.readyState===4)if(c.status===200){var a=e.videoNode._captionatorOptions||{};if(e.kind==="metadata"){a.processCueHTML=false;a.sanitiseCueHTML=false}d=f.parseCaptions(c.responseText,a);e.readyState=f.TextTrack.LOADED;e.cues.loadCues(d);e.activeCues.refreshCues.apply(e.activeCues);
e.videoNode._captionator_dirtyBit=true;f.rebuildCaptions(e.videoNode);e.onload.call(this);b instanceof Function&&b.call(e,d)}else{e.readyState=f.TextTrack.ERROR;e.onerror()}};try{c.send(null)}catch(i){e.readyState=f.TextTrack.ERROR;e.onerror(i)}}};this.addCue=function(a){if(a&&a instanceof f.TextTrackCue)this.cues.addCue(a);else throw Error("The argument is null or not an instance of TextTrackCue.");};this.removeCue=function(){}};f.TextTrack.NONE=0;f.TextTrack.LOADING=1;f.TextTrack.LOADED=2;f.TextTrack.ERROR=
3;f.TextTrack.OFF=0;f.TextTrack.HIDDEN=1;f.TextTrack.SHOWING=2;f.TextTrackCue=function(b,d,a,c,e,i,l){this.id=b;this.track=l instanceof f.TextTrack?l:null;this.startTime=parseFloat(d);this.endTime=parseFloat(a)>=this.startTime?parseFloat(a):this.startTime;this.text="string"===typeof c||c instanceof f.CaptionatorCueStructure?c:"";this.settings="string"===typeof e?e:"";this.pauseOnExit=!!i;this.vertical=this.wasActive=!1;this.snapToLines=!0;this.line="auto";this.position=50;this.size=0;this.align="middle";
if(this.settings.length){var g=this,e=e.split(/\s+/).filter(function(a){return 0<a.length});e instanceof Array&&e.forEach(function(a){var b={L:"line",T:"position",A:"align",S:"size",direction:"direction",line:"line",position:"position",size:"size",align:"align"},a=a.split(":");b[a[0]]in g&&(g[b[a[0]]]=a[1])})}this.line.match(/\%/)&&(this.snapToLines=!1);this.getCueAsSource=function(){return""+this.text};this.getCueAsHTML=function(){var a=document.createDocumentFragment(),b=document.createElement("div");
b.innerHTML=""+this.text;Array.prototype.forEach.call(b.childNodes,function(b){a.appendChild(b.cloneNode(true))});return a};this.isActive=function(){var a=0;if(this.track instanceof f.TextTrack&&(this.track.mode===f.TextTrack.SHOWING||this.track.mode===f.TextTrack.HIDDEN)&&this.track.readyState===f.TextTrack.LOADED)try{a=this.track.videoNode.currentTime;if(this.startTime<=a&&this.endTime>=a){if(!this.wasActive){this.wasActive=true;this.onenter()}return true}}catch(b){return false}if(this.wasActive){this.wasActive=
false;this.onexit()}return false};Object.prototype.__defineGetter__?this.__defineGetter__("active",this.isActive):Object.defineProperty&&Object.defineProperty(this,"active",{get:this.isActive});this.toString=function(){return"TextTrackCue:"+this.id+"\n"+(""+this.text)};this.onenter=function(){};this.onexit=function(){}};f.TextTrackCueList=function(b){this.track=b instanceof f.TextTrack?b:null;this.getCueById=function(b){return this.filter(function(a){return a.id===b})[0]};this.loadCues=function(b){for(var a=
0;a<b.length;a++)b[a].track=this.track,Array.prototype.push.call(this,b[a])};this.addCue=function(b){if(b&&b instanceof f.TextTrackCue)if(b.track===this.track||!b.track)Array.prototype.push.call(this,b);else throw Error("This cue is associated with a different track!");else throw Error("The argument is null or not an instance of TextTrackCue.");};this.toString=function(){return"[TextTrackCueList]"}};f.TextTrackCueList.prototype=[];f.ActiveTextTrackCueList=function(b,d){this.refreshCues=function(){if(b.length){var a=
this,c=!1,f=[].slice.call(this,0);this.length=0;b.forEach(function(b){b.active&&(a.push(b),a[a.length-1]!==f[a.length-1]&&(c=!0))});if(c)try{d.oncuechange()}catch(i){}}};this.toString=function(){return"[ActiveTextTrackCueList]"};this.refreshCues()};f.ActiveTextTrackCueList.prototype=new f.TextTrackCueList(null);var L=function(b){this.targetObject=b;this.currentTime=0;this.addEventListener=function(b,a){"timeupdate"===b&&a instanceof Function&&(this.timeupdateEventHandler=a)};this.attachEvent=function(b,
a){"timeupdate"===b&&a instanceof Function&&(this.timeupdateEventHandler=a)};this.updateTime=function(b){isNaN(b)||(this.currentTime=b)}};f.rebuildCaptions=function(b){var d=b.currentTime,a=[],c=!1,e=[],i=[];(b.textTracks||[]).forEach(function(b){b.mode===f.TextTrack.SHOWING&&b.readyState===f.TextTrack.LOADED&&(i=[].slice.call(b.activeCues,0),i=i.sort(function(b,a){return b.startTime>a.startTime?-1:1}),a=a.concat(i))});e=a.map(function(b){return b.track.id+"."+b.id+":"+b.text.toString(d).length});
if((c=!f.compareArray(e,b._captionator_previousActiveCues))||b._captionator_dirtyBit)b._captionator_dirtyBit=!1,b._captionator_availableCueArea=null,b._captionator_previousActiveCues=e,f.styleCueCanvas(b),[].slice.call(b._descriptionContainerObject.getElementsByTagName("div"),0).concat([].slice.call(b._containerObject.getElementsByTagName("div"),0)).forEach(function(b){b.cueObject&&!b.cueObject.active&&(b.cueObject.rendered=!1,b.cueObject.domNode=null,b.parentElement.removeChild(b))}),a.forEach(function(a){var c,
e;"metadata"!==a.track.kind&&a.mode!==f.TextTrack.HIDDEN&&(a.rendered?(c=a.domNode,e=c.getElementsByClassName("captionator-cue-inner")[0],a.text.toString(d)!==c.currentText&&(c.currentText=a.text.toString(d),e.innerHTML=c.currentText,e.spanified=!1)):(c=document.createElement("div"),e=document.createElement("span"),e.className="captionator-cue-inner",c.id=(""+a.id).length?a.id:f.generateID(),c.className="captionator-cue",c.appendChild(e),c.cueObject=a,a.domNode=c,c.setAttribute("lang",a.track.language),
c.currentText=a.text.toString(d),e.innerHTML=c.currentText,a.rendered=!0,"descriptions"===a.track.kind?b._descriptionContainerObject.appendChild(c):b._containerObject.appendChild(c)),"descriptions"!==a.track.kind&&f.styleCue(c,a,b))})};f.captionify=function(b,d,a){var c=[],e=0,a=a instanceof Object?a:{};a.minimumFontSize&&"number"===typeof a.minimumFontSize&&(w=a.minimumFontSize);a.minimumLineHeight&&"number"===typeof a.minimumLineHeight&&(B=a.minimumLineHeight);a.fontSizeVerticalPercentage&&"number"===
typeof a.fontSizeVerticalPercentage&&(F=a.fontSizeVerticalPercentage);a.lineHeightRatio&&"number"!==typeof a.lineHeightRatio&&(G=a.lineHeightRatio);a.cueBackgroundColour&&a.cueBackgroundColour instanceof Array&&(K=a.cueBackgroundColour);if(!HTMLVideoElement&&!(b instanceof L)&&!a.forceCaptionify||("function"===typeof document.createElement("video").addTextTrack||"function"===typeof document.createElement("video").addTrack)&&!a.forceCaptionify)return!1;!C&&a.exportObjects&&(window.TextTrack=f.TextTrack,
window.TextTrackCueList=f.TextTrackCueList,window.ActiveTextTrackCueList=f.ActiveTextTrackCueList,window.TextTrackCue=f.TextTrackCue,C=!0);if(!b||!1===b||void 0===b||null===b)c=[].slice.call(document.getElementsByTagName("video"),0);else if(b instanceof Array)for(e=0;e<b.length;e++)"string"===typeof b[e]?c=c.concat([].slice.call(document.querySelectorAll(b[e]),0)):b[e].constructor===HTMLVideoElement&&c.push(b[e]);else"string"===typeof b?c=[].slice.call(document.querySelectorAll(b),0):b.constructor===
HTMLVideoElement&&c.push(b);return c.length?(c.forEach(function(b){b.addTextTrack=function(a,c,d,e,s){var r=["subtitles","captions","descriptions","captions","metadata","chapters"];r.slice(0,7);a=typeof a==="string"?a:"";d=typeof d==="string"?d:"";e=typeof e==="string"?e:"";if(r.filter(function(a){return c===a?true:false}).length){if(a=new f.TextTrack(a,c,d,e,s,null)){if(!(b.textTracks instanceof Array))b.textTracks=[];b.textTracks.push(a);return a}return false}throw f.createDOMException(12,"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.",
"SYNTAX_ERR");};f.processVideoElement(c[e],d,a)}),!0):!1};f.parseCaptions=function(b,d){var d=d instanceof Object?d:{},a="",c=[],e="",i=[],l=/^(\d+)?:?(\d+):(\d+)\.(\d+)\,(\d+)?:?(\d+):(\d+)\.(\d+)\s*(.*)/,g=/^(\d+)?:?(\d+):(\d+)\.(\d+)\,(\d+)?:?(\d+):(\d+)\.(\d+)\s*(.*)/,p=/^(\d+)?:?(\d+):(\d+)[\.\,](\d+)\s+\-\-\>\s+(\d+)?:?(\d+):(\d+)[\.\,](\d+)\s*(.*)/,h=/(\d+)?:?(\d+):(\d+)[\.\,](\d+)/,s=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/,r=/^\[(\d+)?:?(\d+)\:(\d+)\.(\d{2,3})\]\s*(.*?)$/,u=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,
y=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,z=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g,m=/<tt\s+xml/ig,o=/^(\d+)?:?(\d+):(\d+)\.(\d+)/;if(b){var v=function(a){var b=new f.CaptionatorCueStructure(a,d),c=[],e,g,i,j=[];i=0;var l=function(a){return!!a.replace(/[^a-z0-9]+/ig,"").length},c=a.split(/(<\/?[^>]+>)/ig);i=b;for(e in c)if(c.hasOwnProperty(e))if(g=c[e],"<"===g.substr(0,1))if("/"===g.substr(1,1)){if(a=g.substr(2).split(/[\s>]+/g)[0],0<j.length){g=0;for(i=j.length-1;0<=i;i--){var p=j[i][j[i].length-
1];g=i;if(p.token===a)break}i=j[g];j=j.slice(0,g)}}else{if(g.substr(1).match(h)||(g.match(/^<v\s+[^>]+>/i)||g.match(/^<c[a-z0-9\-\_\.]+>/)||g.match(/^<(b|i|u|ruby|rt)>/))||!1!==d.sanitiseCueHTML){a={token:g.replace(/[<\/>]+/ig,"").split(/[\s\.]+/)[0],rawToken:g,children:[]};if("v"===a.token)a.voice=g.match(/^<v\s*([^>]+)>/i)[1];else if("c"===a.token)a.classes=g.replace(/[<\/>\s]+/ig,"").split(/[\.]+/ig).slice(1).filter(l);else if(g=a.rawToken.match(h))b.isTimeDependent=!0,g=g.slice(1),a.timeIn=parseInt(3600*
(g[0]||0),10)+parseInt(60*(g[1]||0),10)+parseInt(g[2]||0,10)+parseFloat("0."+(g[3]||0));i.push(a);j.push(i);i=a.children}}else!1!==d.sanitiseCueHTML&&(g=g.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;"),d.ignoreWhitespace||(g=g.replace(/\n+/g,"<br />"))),i.push(g);return b},A=function(a){var b=0;if("string"!==typeof a)return 0;if(a=o.exec(a))a=a.slice(1),b=parseInt(3600*(a[0]||0),10)+parseInt(60*(a[1]||0),10)+parseInt(a[2]||0,10)+parseFloat("0."+(a[3]||0));return b},w=function(a,
b){var c,e=0,g=0,e=""+a.getAttribute("begin");c=""+a.getAttribute("end");var i=a.getAttribute("id")||b,e=A(e),g=A(c);c=!1===d.processCueHTML?a.innerHTML:v(a.innerHTML);return new f.TextTrackCue(i,e,g,c,{},!1,null)},c=b.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(m.exec(b))return m=document.createElement("ttml"),m.innerHTML=b,[].slice.call(m.querySelectorAll("[begin],[end]"),0).map(w);b.split(/\n+/g).reduce(function(a,b){return a||!!r.exec(b)},!1)?(c=c.split(/\n+/g),a="LRC"):c=c.split(/\n\n+/g);c=
c.filter(function(b){if(b.match(/^WEBVTT(\s*FILE)?/ig)){a="WebVTT";return false}return b.replace(/\s*/ig,"").length?true:false}).map(function(b,c){var h,m,o,k,j,t="",q;if(q=u.exec(b)){i=q.slice(2).join("");i=i.split(/\s+/g).filter(function(a){return a&&!!a.length});return null}if(q=y.exec(b)){e=e+q[q.length-1];return null}if(q=z.exec(b))return null;for(h=a==="LRC"?[b.substr(0,b.indexOf("]")+1),b.substr(b.indexOf("]")+1)]:b.split(/\n/g);!h[0].replace(/\s+/ig,"").length&&h.length>0;)h.shift();for(q=
h[0].match(/^\s*[a-z0-9\-]+\s*$/ig)?""+h.shift().replace(/\s*/ig,""):c;0<h.length;){var n=h[0];if((j=p.exec(n))||(j=l.exec(n))||(j=g.exec(n))){j=j.slice(1);m=parseInt((j[0]||0)*3600,10)+parseInt((j[1]||0)*60,10)+parseInt(j[2]||0,10)+parseFloat("0."+(j[3]||0));o=parseInt((j[4]||0)*3600,10)+parseInt((j[5]||0)*60,10)+parseInt(j[6]||0,10)+parseFloat("0."+(j[7]||0));j[8]&&(t=j[8])}else if(j=s.exec(n)){j=j.slice(1);m=parseFloat(j[0]);o=m+parseFloat(j[1]);j[2]&&(t=j[2])}else if(j=r.exec(n)){j=j.slice(1,
j.length-1);o=m=parseInt((j[0]||0)*3600,10)+parseInt((j[1]||0)*60,10)+parseInt(j[2]||0,10)+parseFloat("0."+(j[3]||0))}h=h.slice(0,0).concat(h.slice(1));break}if(!m&&!o)return null;j=i.reduce(function(a,b){a[b.split(":")[0]]=b.split(":")[1];return a},{});j=t.split(/\s+/g).filter(function(a){return a&&!!a.length}).reduce(function(a,b){a[b.split(":")[0]]=b.split(":")[1];return a},j);t="";for(k in j)if(j.hasOwnProperty(k)){t=t+(t.length?" ":"");t=t+(k+":"+j[k])}k=d.processCueHTML===false?h.join("\n"):
v(h.join("\n"));m=new f.TextTrackCue(q,m,o,k,t,false,null);m.styleData=e;return m}).filter(function(a){return a!==null?true:false});"LRC"===a&&(c.forEach(function(a,b){var d=0,f;if(b>0){d=a.startTime;f=c[--b];if(f.endTime<d)f.endTime=d}}),c=c.filter(function(a){return a.text.toString().replace(/\s*/,"").length>0?true:false}));return c}throw Error("Required parameter captionData not supplied.");};f.processVideoElement=function(b,d,a){var c=[],e=navigator.language||navigator.userLanguage;d||e.split("-");
a=a instanceof Object?a:{};b.captioned||(b._captionatorOptions=a,b.className+=(b.className.length?" ":"")+"captioned",b.captioned=!0,0===b.id.length&&(b.id=f.generateID()),[].slice.call(b.querySelectorAll("track"),0).forEach(function(e){var l=null,l=e.querySelectorAll("source").length>0?e.querySelectorAll("source"):e.getAttribute("src"),l=b.addTextTrack(e.getAttribute("id")||f.generateID(),e.getAttribute("kind"),e.getAttribute("label"),e.getAttribute("srclang").split("-")[0],l,e.getAttribute("type"),
e.hasAttribute("default"));e.track=l;l.trackNode=e;l.videoNode=b;c.push(l);var g=false;if((l.kind==="subtitles"||l.kind==="captions")&&d===l.language&&a.enableCaptionsByDefault)c.filter(function(a){return(a.kind==="captions"||a.kind==="subtitles")&&d===a.language&&a.mode===f.TextTrack.SHOWING?true:false}).length||(g=true);l.kind==="chapters"&&d===l.language&&(c.filter(function(a){return a.kind==="chapters"&&a.mode===f.TextTrack.SHOWING?true:false}).length||(g=true));l.kind==="descriptions"&&(a.enableDescriptionsByDefault===
true&&d===l.language)&&(c.filter(function(a){return a.kind==="descriptions"&&a.mode===f.TextTrack.SHOWING?true:false}).length||(g=true));g===true&&c.forEach(function(a){if(a.trackNode.hasAttribute("default")&&a.mode===f.TextTrack.SHOWING)a.mode=f.TextTrack.HIDDEN});if(e.hasAttribute("default")&&!c.filter(function(a){return a.trackNode.hasAttribute("default")&&a.trackNode!==e?true:false}).length){g=true;l.internalDefault=true}if(g===true)l.mode=f.TextTrack.SHOWING}),b.addEventListener("timeupdate",
function(b){b=b.target;try{b.textTracks.forEach(function(a){a.activeCues.refreshCues.apply(a.activeCues)})}catch(c){}a.renderer instanceof Function?a.renderer.call(f,b):f.rebuildCaptions(b)},!1),window.addEventListener("resize",function(){b._captionator_dirtyBit=true;f.rebuildCaptions(b)},!1),!0===a.enableHighResolution&&window.setInterval(function(){try{b.textTracks.forEach(function(a){a.activeCues.refreshCues.apply(a.activeCues)})}catch(c){}a.renderer instanceof Function?a.renderer.call(f,b):f.rebuildCaptions(b)},
20));return b};f.getNodeMetrics=function(b){for(var d=window.getComputedStyle(b,null),a=b,c=b.offsetTop,e=b.offsetLeft,f=b,l=0,g=0,f=parseInt(d.getPropertyValue("width"),10),l=parseInt(d.getPropertyValue("height"),10);a=a.offsetParent;)c+=a.offsetTop,e+=a.offsetLeft;b.hasAttribute("controls")?(b=navigator.userAgent.toLowerCase(),-1!==b.indexOf("chrome")?g=32:-1!==b.indexOf("opera")?g=25:-1!==b.indexOf("firefox")?g=28:-1!==b.indexOf("ie 9")||-1!==b.indexOf("ipad")?g=44:-1!==b.indexOf("safari")&&(g=
25)):b._captionatorOptions&&(b=b._captionatorOptions,b.controlHeight&&(g=parseInt(b.controlHeight,10)));return{left:e,top:c,width:f,height:l,controlHeight:g}};f.applyStyles=function(b,d){for(var a in d)({}).hasOwnProperty.call(d,a)&&(b.style[a]=d[a])};f.checkDirection=function(b){var d=RegExp("^[^\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]*[A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]");return RegExp("^[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]").test(b)?
"rtl":d.test(b)?"ltr":""};f.styleCue=function(b,d,a){var c=0,e=0,i=0,l=0,g,p,h=0,s=0,r,u,y,z,m,o,v=0,A=g=c=0,I=0,D=0,H,E,x=0,C=a._captionatorOptions||{},k,e=50,c=h=0,e=!0;g="";var j,t=function(a){if(a.spanified)return a.characterCount;var b=function(a){return!!a.length},c,d,e,g,h=0,i=function(a){h++;f.applyStyles(a,{display:"block",lineHeight:"auto",height:r+"px",width:o+"px",textAlign:"center"})};for(c in a.childNodes)a.childNodes.hasOwnProperty(c)&&!a.childNodes[c].nospan&&(d=a.childNodes[c],3===
d.nodeType?(g=document.createDocumentFragment(),e=d.nodeValue,g.appendChild(document.createElement("span")),g.childNodes[0].innerHTML="<span class='captionator-cue-character'>"+e.split(/(.)/).filter(b).join("</span><span class='captionator-cue-character'>")+"</span>",[].slice.call(g.querySelectorAll("span.captionator-cue-character"),0).forEach(i),d.parentNode.replaceChild(g,d)):1===a.childNodes[c].nodeType&&(h+=t(a.childNodes[c])));a.characterCount=h;a.spanified=!0;return h};k=f.getNodeMetrics(a);
a._captionator_availableCueArea||(a._captionator_availableCueArea={bottom:k.height-k.controlHeight,right:k.width,top:0,left:0,height:k.height-k.controlHeight,width:k.width});d.vertical||(f.applyStyles(b,{width:"auto",position:"static",display:"inline-block",padding:"1em"}),h=parseInt(b.offsetWidth,10),c=Math.floor(100*(h/a._captionator_availableCueArea.width)),c=100>=c?c:100);h=72*(k.height*(F/100)/96);h=h>=w?h:w;r=Math.floor(96*(h/72));u=Math.floor(h*G);u=u>B?u:B;o=m=Math.ceil(96*(u/72));m*Math.floor(k.height/
m)<k.height&&(m=Math.floor(k.height/Math.floor(k.height/m)),u=Math.ceil(72*(m/96)));m*Math.floor(k.width/m)<k.width&&(o=Math.ceil(k.width/Math.floor(k.width/m)));y=Math.floor(a._captionator_availableCueArea.height/m);z=Math.floor(a._captionator_availableCueArea.width/o);0===parseFloat((""+d.size).replace(/[^\d\.]/ig,""))?!0===C.sizeCuesByTextBoundingBox?g=c:(g=100,e=!1):(e=!1,g=parseFloat((""+d.size).replace(/[^\d\.]/ig,"")),g=100>=g?g:100);h=d.vertical?Math.floor(0.01*k.width):0;s=d.vertical?0:Math.floor(0.01*
k.height);"auto"===d.line?d.line=d.vertical?y:z:(""+d.line).match(/\%/)&&(d.snapToLines=!1,d.line=parseFloat((""+d.line).replace(/\%/ig,"")));if(d.vertical){if(e=a._captionator_availableCueArea.top,c=a._captionator_availableCueArea.right-o,i=o,l=a._captionator_availableCueArea.height*(g/100),c=t(b),g=[].slice.call(b.querySelectorAll("span.captionator-cue-character"),0),v=Math.floor((l-2*s)/r),i=Math.ceil(c/v)*o,A=Math.ceil(c/v),I=(c-v*(A-1))*r,!0===d.snapToLines?c="lr"===d.vertical?a._captionator_availableCueArea.left:
a._captionator_availableCueArea.right-i:(c=i+2*h,c="lr"===d.vertical?(k.width-c)*(d.line/100):k.width-c-(k.width-c)*(d.line/100)),"auto"===d.position?e=(a._captionator_availableCueArea.bottom-l)/2+a._captionator_availableCueArea.top:(d.position=parseFloat((""+d.position).replace(/[^\d\.]/ig,"")),e=(a._captionator_availableCueArea.bottom-l)*(d.position/100)+a._captionator_availableCueArea.top),E=H=x=D=0,g.forEach(function(a){H=d.vertical==="lr"?o*D:i-o*(D+1);d.align==="start"||d.align!=="start"&&D<
A-1?E=x*r+s:d.align==="end"?E=x*r-r+(l+s*2-I):d.align==="middle"&&(E=(l-s*2-I)/2+x*r);a.setAttribute("aria-hidden","true");f.applyStyles(a,{position:"absolute",top:E+"px",left:H+"px"});if(x>=v-1){x=0;D++}else x++}),!b.accessified)g=d.text.getPlain(a.currentTime),j=document.createElement("div"),j.innerHTML=g,j.nospan=!0,b.appendChild(j),b.accessified=!0,f.applyStyles(j,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"})}else(l=m,"auto"!==d.position&&e&&
(e=parseFloat((""+d.position).replace(/[^\d\.]/ig,"")),g=g-e>c?g-e:c),i=!0===d.snapToLines?a._captionator_availableCueArea.width*(g/100):k.width*(g/100),"auto"===d.position?c=(a._captionator_availableCueArea.right-i)/2+a._captionator_availableCueArea.left:(e=parseFloat((""+d.position).replace(/[^\d\.]/ig,"")),c=(a._captionator_availableCueArea.right-i)*(e/100)+a._captionator_availableCueArea.left),!0===d.snapToLines)?e=(y-1)*m+a._captionator_availableCueArea.top:(e=k.controlHeight+m+2*s,e=(k.height-
e)*(d.line/100));d.vertical||(p="rtl"===f.checkDirection(""+d.text)?{start:"right",middle:"center",end:"left"}[d.align]:{start:"left",middle:"center",end:"right"}[d.align]);f.applyStyles(b,{position:"absolute",overflow:"hidden",width:i+"px",height:l+"px",top:e+"px",left:c+"px",padding:s+"px "+h+"px",textAlign:p,backgroundColor:"rgba("+K.join(",")+")",direction:f.checkDirection(""+d.text),lineHeight:u+"pt",boxSizing:"border-box"});if(d.vertical)c-a._captionator_availableCueArea.left-a._captionator_availableCueArea.left>=
a._captionator_availableCueArea.right-(c+i)?a._captionator_availableCueArea.right=c:a._captionator_availableCueArea.left=c+i,a._captionator_availableCueArea.width=a._captionator_availableCueArea.right-a._captionator_availableCueArea.left;else{if(b.scrollHeight>1.2*b.offsetHeight){if(d.snapToLines){for(p=0;b.scrollHeight>1.2*b.offsetHeight;)l+=m,b.style.height=l+"px",p++;e-=p*m}else l=b.scrollHeight+s,e=k.controlHeight+l+2*s,e=(k.height-e)*(d.line/100),b.style.height=l+"px";b.style.top=e+"px"}e-a._captionator_availableCueArea.top-
a._captionator_availableCueArea.top>=a._captionator_availableCueArea.bottom-(e+l)&&a._captionator_availableCueArea.bottom>e?a._captionator_availableCueArea.bottom=e:a._captionator_availableCueArea.top<e+l&&(a._captionator_availableCueArea.top=e+l);a._captionator_availableCueArea.height=a._captionator_availableCueArea.bottom-a._captionator_availableCueArea.top}if(C.debugMode){var q,n,J=function(){if(!q)if(a._captionatorDebugCanvas){q=a._captionatorDebugCanvas;n=a._captionatorDebugContext}else{q=document.createElement("canvas");
q.setAttribute("width",k.width);q.setAttribute("height",k.height-k.controlHeight);document.body.appendChild(q);f.applyStyles(q,{position:"absolute",top:k.top+"px",left:k.left+"px",width:k.width+"px",height:k.height-k.controlHeight+"px",zIndex:3E3});n=q.getContext("2d");a._captionatorDebugCanvas=q;a._captionatorDebugContext=n}};J();q.setAttribute("width",k.width);J();n.fillStyle="rgba(100,100,255,0.5)";n.fillRect(a._captionator_availableCueArea.left,a._captionator_availableCueArea.top,a._captionator_availableCueArea.right,
a._captionator_availableCueArea.bottom);n.stroke();(function(){var b;J();n.strokeStyle="rgba(255,0,0,0.5)";n.lineWidth=1;n.beginPath();for(b=0;b<y;b++){n.moveTo(0.5,b*m+0.5);n.lineTo(k.width,b*m+0.5)}n.closePath();n.stroke();n.beginPath();n.strokeStyle="rgba(0,255,0,0.5)";for(b=z;b>=0;b--){n.moveTo(k.width-b*o-0.5,-0.5);n.lineTo(k.width-b*o-0.5,k.height)}n.closePath();n.stroke();n.beginPath();n.strokeStyle="rgba(255,255,0,0.5)";for(b=0;b<=z;b++){n.moveTo(b*o+0.5,-0.5);n.lineTo(b*o+0.5,k.height)}n.stroke();
a.linesDrawn=true})()}};f.styleCueCanvas=function(b){var d,a,c,e,i=b._captionatorOptions instanceof Object?b._captionatorOptions:{};if(!(b instanceof HTMLVideoElement))throw Error("Cannot style a cue canvas for a non-video node!");b._containerObject&&(a=b._containerObject);b._descriptionContainerObject&&(c=b._descriptionContainerObject);c?c.parentNode||document.body.appendChild(c):(c=document.createElement("div"),c.className="captionator-cue-descriptive-container",e=f.generateID(),c.id=e,b._descriptionContainerObject=
c,c.setAttribute("aria-live","polite"),c.setAttribute("aria-atomic","true"),c.setAttribute("role","region"),document.body.appendChild(c),f.applyStyles(c,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"}));if(a)a.parentNode||document.body.appendChild(a);else{a=document.createElement("div");a.className="captionator-cue-canvas";c=f.generateID();a.id=c;if(i.appendCueCanvasTo){c=null;if(i.appendCueCanvasTo instanceof HTMLElement)c=i.appendCueCanvasTo;else if("string"===
typeof i.appendCueCanvasTo)try{if(d=document.querySelectorAll(i.appendCueCanvasTo),0<d.length)c=d[0];else throw null;}catch(l){c=document.body,i.appendCueCanvasTo=!1}else c=document.body,i.appendCueCanvasTo=!1;c.appendChild(a)}else document.body.appendChild(a);b._containerObject=a}c=f.getNodeMetrics(b);b=72*(c.height*(F/100)/96);b=b>=w?b:w;d=Math.floor(b*G);d=d>B?d:B;f.applyStyles(a,{position:"absolute",overflow:"hidden",zIndex:100,height:c.height-c.controlHeight+"px",width:c.width+"px",top:(i.appendCueCanvasTo?
0:c.top)+"px",left:(i.appendCueCanvasTo?0:c.left)+"px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",fontSize:b+"pt",lineHeight:d+"pt",boxSizing:"border-box"})};f.createDOMException=function(b,d,a){try{document.querySelectorAll("div/[]")}catch(c){var e=function(a,b,c){this.code=a;this.message=b;this.name=c};e.prototype=c;return new e(b,d,a)}};f.compareArray=function(b,d){if(!(b instanceof Array)||!(d instanceof Array)||b.length!==d.length)return!1;for(var a in b)if(b.hasOwnProperty(a)&&
b[a]!==d[a])return!1;return!0};f.generateID=function(b){for(var d="",b=b?b:10;d.length<b;)d+=String.fromCharCode(65+Math.floor(26*Math.random()));return"captionator"+d}})();